/*! liberio-app - v0.1.0 - 2015-01-27
* Copyright (c) 2015 Nicolas Zimmer <nicolas@liber.io> (http://liber.io); Licensed CC BY-SA */
function createGooglePicker(e,t,i,n,a,o,r,s,c,l,d,u){$("#"+l).filter(":button").button("loading");var p=new google.picker.View(google.picker.ViewId.DOCS);e.length>0&&p.setMimeTypes(e);var g=(new google.picker.PickerBuilder).setAppId(t).setOAuthToken(i).addView(p).addView(new google.picker.DocsUploadView).setCallback(function(e){googlePickerCallback(e,a,o,r,s,c,l,d,u)}).build();g.setVisible(!0)}function googlePickerCallback(e,t,i,n,a,o,r,s,c){if(e.action==google.picker.Action.PICKED){var l=e.docs[0].id;i=i===void 0?"":"&selector="+i,n=n===void 0?"":"&do="+n,s===void 0?$("#alerts").html('<p class="text-center space-top-10" id="signal"><span class="signal" style="position: absolute;left: 50%;margin: 2px -150px;"></span>Retrieving data from GoogleDrive</p>'):(fn=window[s],"function"==typeof fn&&fn()),$.getJSON("?trigger="+t+i+n+"&target="+a+"&fileIds="+l+"&id="+l+"&method="+o+"&callback="+c+"&signature="+window.btoa($("meta[property='sf:user']").attr("content")),function(e){$("#signal").remove(),SFReloadContent("#"+e.target,e.content,e.method,e.js,e.callback,e.values),mInit(!1)})}$("#"+r).filter(":button").button("reset")}function mInit(e){"none"!==e&&$("html, body").animate({scrollTop:"0px"}),$("body").removeData("processing"),$(".overlay").hide(),$(".has-tooltip").tooltip(),$(".has-popover").popover(),$(".dd").length>0&&$(".dd").nestable({maxDepth:1}),$(".dial").length&&$(".dial").knob(),$(".sticky-popover").popover({trigger:"manual"}).on("click",function(e){e.preventDefault()}).on("mouseenter",function(){var e=this;$(this).popover("show"),$(this).data("popover").tip().on("mouseleave",function(){$(e).popover("hide")})}).on("mouseleave",function(){var e=this;setTimeout(function(){$(".popover:hover").length||$(e).popover("hide")},100)}),$("a.new").prepend('<span class="overlay-new-item"><img src="//s3.amazonaws.com/liberio/assets/images/new_item_ribbon.png" alt="new"></span>'),2==window.devicePixelRatio&&$("img.retina").each(function(){var e=$(this).attr("src").replace(/(@2x)*.png/i,"@2x.png").replace(/(@2x)*.jpg/i,"@2x.jpg");$(this).attr("src",e)}),$(".tagsinput").length&&($(".tagsinput").tagsinput(),$(".tagsinput").tagsinput({confirmKeys:[13,188,186],inputSize:10})),"undefined"!=typeof Showdown&&(convert=(new Showdown.converter).makeHtml),$("#markdown").keyup(function(){$("#preview").html(convert($("#markdown").val())),$("#markdown").height($("#preview").height())}).trigger("keyup"),$("#validation .icon-refresh").animateRotate(360,"slow","swing"),$("#user-activity").length&&"undefined"!=typeof google&&drawUserActivity(),$(".spinner").length&&"undefined"!=typeof Spinners&&Spinners.create(".spinner",{radius:20,height:15,width:2,dashes:30,opacity:1,padding:3,rotation:700,color:"#919191"}).center().play()}function checkCoachmarks(){$.getJSON("?trigger=application&do=coachmark&view="+$("#center div:first-child").attr("id")+"&item="+$("#uid").val()+"&signature="+window.btoa($("meta[property='sf:user']").attr("content")),function(e){e.content&&($("body").append('<div class="modalizer fade" data-role="modal" id="liberio-coachmark" aria-hidden="true" style="display: none;"></div>'),$("#liberio-coachmark").modal("show"),$("#liberio-coachmark").html(e.content),e.target&&$(e.target).find("a:first-child").toggleClass("highlight-coachmark"))})}function SFCheckAlerts(){$.getJSON("?trigger=alert&nonce="+$("meta[property='sf:nonce']").attr("content")+"&signature="+window.btoa($("meta[property='sf:user']").attr("content")),function(e){e&&SFReloadContent("#alerts",e.content,"update")})}function SFReloadContent(e,t,i,n,a,o){if($(e).length)switch(i){case"append":$(e).append(t);break;case"prepend":$(e).prepend(t);break;default:$(e).html(t)}n&&$.each(n,function(e,t){$.getScript(t)}),a&&$.each(a,function(e,t){fn=window[t],"function"==typeof fn&&fn(o)})}function popOverHide(){$(".has-popover").popover("hide")}function flipVertical(){var e=$("#landing-cloud-container a.in"),t=e.next("a");t.length&&(e.removeClass("in"),t.addClass("in"),flipTimeout=setTimeout(flipVertical,2e3))}function _navigateTo(e,t){$.getJSON("?trigger="+e+"&signature="+window.btoa($("meta[property='sf:user']").attr("content")),t,function(e){$("html, body").animate({scrollTop:"0px"}),SFReloadContent("#main",e.content,e.method,e.js,e.callback),mInit()})}function checkForNotification(){return $("meta[property='sf:user']").attr("content")===void 0?null:($.getJSON("/api/1.0/notifications.json/list",function(e){e&&($.each(e.records,function(e,t){notifications[t.uid]=t.message}),renderNotification("#update-notification",notifications))}),void 0)}function renderNotification(e,t){var i=Object.keys(t).length?Object.keys(t).length:"";i?($(e+"-action").addClass("notification-active"),$(e+"-action > i").addClass("notification-active")):($(e+"-action").removeClass("notification-active"),$(e+"-action > i").removeClass("notification-active")),$(e+" span.badge").text(i)}function notifyUser(e,t,i,n){"alert"!==n&&("Notification"in window?"granted"===Notification.permission?new Notification(t,i):"denied"!==Notification.permission&&Notification.requestPermission(function(e){"permission"in Notification||(Notification.permission=e),"granted"===e&&new Notification(t,i)}):growlAlert(e,t,i.body)),("always"===n||"alert"===n)&&growlAlert(e,t,i.body)}function growlAlert(e,t,i){mId=(new Date).getTime(),mContent="<div class='alert "+e+"' style='display:none' id='"+mId+"'><button type='button' class='close' data-dismiss='alert'>&times;</button><b>"+t+"</b>&nbsp;"+i+"</div>",$("#alerts").append(mContent),$("#"+mId).slideDown("fast").delay(5e3).fadeOut("slow",function(){$(this).remove()})}function drawUserActivity(){$.getJSON("api/1.0/analytics.json/me",function(e){var t=google.visualization.arrayToDataTable(e.records),i={chart:{title:"Your Activity",subtitle:"Daily Words Published: Last Month"},bars:"vertical",animation:{duration:1e3,easing:"out"}};if(e.records[1]){var n=new google.charts.Bar(document.getElementById("user-activity"));n.draw(t,google.charts.Bar.convertOptions(i))}else $("#user-activity").hide()})}function checkLinterData(e){e===void 0&&(e=$("[data-role=receiver]").attr("id")),$.getJSON("api/1.0/documents.json/"+e,function(e){e.linter!==void 0&&$.each(e.linter,function(e,t){var i;switch(e){case"structure":i="Please check your text's formatting:";break;case"toc":i="Avoid redundant elements:";break;case"sizes":i="Increase readability:";break;default:i="Potential problem with your document:"}growlAlert("warning",i,t)})})}$(document).on("click",".google-picker-btn",function(){return createGooglePicker($(this).data("mime-types"),$(this).data("client-id"),$(this).data("oauth-token"),$(this).data("auth-user"),$(this).data("plugin"),$(this).data("selector"),$(this).data("do"),$(this).data("target"),$(this).data("method"),$(this).attr("id"),$(this).data("spinner"),$(this).data("callback")),!1});var alert,g_cid,notifications={},socket,stripeHandler,signature,flipTimeout;$(document).ready(function(){flipTimeout=setTimeout(flipVertical,1500),$("[data-typer-targets]").length&&$("[data-typer-targets]").typer(),signature=="&signature="+window.btoa($("meta[property='sf:user']").attr("content")),"undefined"!=typeof Dropzone&&(Dropzone.autoDiscover=!1);var e=$("meta[property='sf:node']").attr("content");"undefined"!=typeof io&&(socket=io.connect("https://connect.liber.io")),"undefined"!=typeof StripeCheckout&&(stripeHandler=StripeCheckout.configure({key:"pk_RkPc1XRPcIJqFbhWMIGZLHWa2hOWq",image:"/assets/images/liberio/product/liberio_stripe.png",token:function(e){$(".has-overlay").find(".overlay").show();var t=$("#"+$("body").data("processing")),i={};t.data("invoice")!==void 0&&(e.invoice=t.data("invoice")),e.amount=t.data("amount"),e.currency=t.data("currency"),e.description=t.data("description"),i.values=e,$.post("api/1.0/payments.json?nonce="+$("meta[property='sf:nonce']").attr("content")+"&signature="+window.btoa($("meta[property='sf:user']").attr("content"))+"&g_cid="+g_cid+("epub-package-gift"==t.data("transaction-type")?"&token=dW5kZWZpbmVk":""),i,function(e){if("ok"==e.status)switch(t.parent().html("<span style='width:35px;display:inline-block;vertical-align:middle;' class='success'><i class='liberio-stripe'></i></span><span>successfully charged</span>"),t.data("transaction-type")){case"epub-package-25":$.getJSON("?trigger=liberioBookView&target=commercial-options&item="+t.data("item")+"&do=makeCommercial&nonce="+$("meta[property='sf:nonce']").attr("content")+"&signature="+window.btoa($("meta[property='sf:user']").attr("content")),function(e){SFCheckAlerts(),SFReloadContent("#"+e.target,e.content,e.method,e.js,e.callback),$(".has-overlay").find(".overlay").hide()});break;case"epub-package-voucher":$.getJSON("?trigger=account&target=main&do=addVoucher&product=epub-package-voucher&nonce="+$("meta[property='sf:nonce']").attr("content")+"&signature="+window.btoa($("meta[property='sf:user']").attr("content")),function(e){SFCheckAlerts(),SFReloadContent("#"+e.target,e.content,e.method,e.js,e.callback),$(".has-overlay").find(".overlay").hide()});break;case"epub-package-gift":var n=$("#personalize-gift").serialize();$.getJSON("?trigger=account&target=main&do=addGift&sender_email="+i.values.email+"&product=epub-package-voucher&nonce="+$("meta[property='sf:nonce']").attr("content")+"&signature="+window.btoa($("meta[property='sf:user']").attr("content")),n,function(e){SFCheckAlerts(),SFReloadContent("#"+e.target,e.content,e.method,e.js,e.callback),$(".has-overlay").find(".overlay").hide()});break;default:}},"json"),$("body").removeData("processing")}})),function(e,t,i,n,a,o,r){e.GoogleAnalyticsObject=a,e[a]=e[a]||function(){(e[a].q=e[a].q||[]).push(arguments)},e[a].l=1*new Date,o=t.createElement(i),r=t.getElementsByTagName(i)[0],o.async=1,o.src=n,r.parentNode.insertBefore(o,r)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-40791230-1","liber.io"),ga("set","dimension1",e),ga("send","pageview"),ga(function(e){g_cid=e.get("clientId"),$("meta[property='sf:g_cid']").attr("content")===void 0&&$.get("?trigger=application&update=ljTyxtAf6wwSCFUBpaUu9owDRyMX%2F1tVtQ%2FsC%2BFUhmg%3D&where=g_cid&value="+g_cid+"&signature="+window.btoa($("meta[property='sf:user']").attr("content")))}),mInit(),checkForNotification(),checkCoachmarks(),$(document).on("paste",".content-title[contenteditable]",function(e){e.preventDefault();var t=(e.originalEvent||e).clipboardData.getData("text/plain")||"";document.execCommand("insertText",!1,t)}),$(document).on("click",".trigger",function(){if($(this).hasClass("confirm")&&!confirm($(this).data("confirm")))return!1;"none"!==$(this).data("animate")&&$("html, body").animate({scrollTop:"0px"}),$(this).data("overlay")&&$($(this).data("overlay")).show();var e="";return $(this).data("loading-text")&&$(this).button("loading"),$(this).data("serialize")&&(e="json"==$(this).data("format")?"&values="+$($(this).data("serialize")).serializeJSON():"&"+$($(this).data("serialize")).serialize()),$(this).data("reset")&&$($(this).data("reset")).val(""),"hide"!=$(this).data("spinner")&&$("#alerts").html('<p style="padding-top:10px" class="text-center"><span class="signal" style="position: absolute;left: 50%;margin: 2px -100px;"></span><strong>Please wait...</strong></p>'),$.post(($(this).data("href")?$(this).data("href"):this.href)+"&nonce="+$("meta[property='sf:nonce']").attr("content")+"&signature="+window.btoa($("meta[property='sf:user']").attr("content"))+"&g_cid="+g_cid+"&animate="+$(this).data("animate"),e,function(e){$("#alerts").html(""),e.content&&SFReloadContent("#"+e.target,e.content,e.method,e.js,e.callback),e.relocate&&(window.location=e.relocate),SFCheckAlerts(),checkCoachmarks(),mInit(e.animate?e.animate:null)},"json"),$(this).data("loading-text")&&$(this).button("reset"),!1}),$('<img src="assets/images/icons/loading_spinner_16.gif" alt="loading">'),$("meta[property='sf:user']").attr("content")&&socket.emit("subscribe",$("meta[property='sf:user']").attr("content")),socket.on("notification",function(e){switch(e.property){case"progress":$("#"+e.subscriber).html()&&$(".dial").length&&($(".dial").knob(),$("#"+e.subscriber+" > div.overlay-progress").show(),$("#epub-editor-save").button("loading"),$("#"+e.subscriber+" .dial").animate({value:e.value},{duration:200,easing:"swing",step:function(){$("#"+e.subscriber+" .dial").trigger("change")},complete:function(){100===e.value&&($("#epub-editor-save").button("reset"),$("#"+e.subscriber+" > .overlay-options").removeAttr("disabled"),e.subscriber.indexOf("liberio")>-1?$.getJSON("api/1.0/books.json/"+e.subscriber,function(t){if("ok"==t.status){var i=t.thumbnail;i&&i!==void 0&&!i.match(/^http([s]?):\/\/.*/)&&(i="//s3.amazonaws.com/user.liber.io/"+i,$("#"+e.subscriber+" .cover > img").attr("src",i).data("original-src",i)),$("#"+e.subscriber+" > p.title").text(t.metadata.title.main),$("#"+e.subscriber+" .timestring").text(t.timestring)}$("#"+e.subscriber+" > div.overlay-progress").hide(),$("#"+e.subscriber+" .dial").val(0),$("#"+e.subscriber+"  .cover").prepend('<div class="overlay-new-item"><img src="//s3.amazonaws.com/liberio/assets/images/new_item_ribbon.png" alt="new"></div>')}):e.subscriber.indexOf("googleDocument")>-1||e.subscriber.indexOf("file_")>-1?$.getJSON("api/1.0/documents.json/"+e.subscriber,function(t){$("#"+e.subscriber+" > div.overlay-progress").hide(),$("#"+e.subscriber+" .dial").val(0),$("#language").val(t.language),$("#keywords")!==void 0&&t.keywords&&($.isArray(t.keywords)?$.each(t.keywords,function(e,t){$("#keywords").tagsinput("add",t)}):$("#keywords").tagsinput("add",t.keywords),$("#keywords").tagsinput("refresh")),t.style&&($("#option-document").attr("value",t.style),$("#style").find(":selected").length||$("#style").val(t.style),$("#style").trigger("change")),t.linter!==void 0&&$.each(t.linter,function(e,t){var i;switch(e){case"structure":i="Please check your text's formatting:";break;case"toc":i="Avoid redundant elements:";break;case"sizes":i="Increase readability:";break;default:i="Potential problem with your document:"}growlAlert("warning",i,t)})}):($("#"+e.subscriber+" > div").hide(),$("#"+e.subscriber+" .dial").val(0)))}}));break;case"exception":e.subscriber==$("meta[property='sf:user']").attr("content")&&(_navigateTo("liberioGridView"),options={},options.icon="assets/images/liberio/product/liberio_icon_square_32.png",options.body=e.value,notifyUser("alert-danger","Sorry, something went wrong...",options,"always"));break;case"information":e.subscriber==$("meta[property='sf:user']").attr("content")&&(options={},options.icon="assets/images/liberio/product/liberio_icon_square_32.png",options.body=e.value,notifyUser("alert-info","Heads Up!",options));break;case"validation":$("#validation").html(e.value);break;default:switch(e.subscriber){case"update-notification":notifications[e.uid]=e.value,renderNotification("#update-notification",notifications);break;default:$("#"+e.subscriber).text(e.value).data("notification",e.uid)}}}),socket.on("reset",function(e){switch(e.subscriber){case"update-notification":notifications={},renderNotification("#update-notification",notifications),$("#update-notification-action").trigger("click");break;default:$("#"+e.subscriber).text("")}})}),$(document).on("click","#trigger-sharing-modal",function(){$("#sharing-modal").modal("show")}),$(document).on("click",".void",function(){return!1}),$(document).on("click",".highlight-coachmark",function(){$(this).removeClass("highlight-coachmark")}),$(document).on("click",".publish",function(){$(this).data("item")&&$.get("?trigger=liberioBookView&do=publish&item="+$(this).data("item")+"&service="+$(this).data("service")+"&source="+$(this).data("source")+"&user="+$("meta[property='sf:user']").attr("content")+"&g_cid="+g_cid+"&signature="+window.btoa($("meta[property='sf:user']").attr("content"))),$(this).addClass("color-"+$(this).data("service")),$(this).removeClass("color-91")}),$(document).on("click",".close",function(){$(this).data("item")&&$.get("?trigger=application&do=hide&item="+$(this).data("item")+"&signature="+window.btoa($("meta[property='sf:user']").attr("content")))}),$(document).on("click",".close-modal",function(){$(".modalizer.in").modal("hide"),$(".modal-backdrop").remove()}),$(document).on("click",".track",function(e){e.preventDefault(),$.get("?trigger=application&do=track&type=event&category="+$(this).data("category")+"&action="+$(this).data("action")+"&label="+$(this).attr("id")+"&caller="+$(this).attr("id")+"&signature="+window.btoa($("meta[property='sf:user']").attr("content")));var t=this.href;console.log(t),ga("send",{hitType:"event",eventCategory:$(this).data("category"),eventAction:$(this).data("action"),eventLabel:$(this).attr("id"),hitCallback:function(){console.log("hitCallback"),t!==void 0&&t&&(window.location=t)}})}),$(document).on("click",".btn-container-download",function(){var e="hiddenDownloader",t=document.getElementById(e);return null===t&&(t=document.createElement("iframe"),t.id=e,t.style.display="none",document.body.appendChild(t)),t.src=$(this).attr("href"),!1}),$("body").on("click",function(e){$('[data-toggle="popover"]').each(function(){$(this).is(e.target)||0!==$(this).has(e.target).length||0!==$(".popover").has(e.target).length||$(this).popover("hide")})}),$(".isEditable").keydown(function(e){13==e.keyCode&&$(this).blur()}),$(".isEditable").blur(function(){$(this).data("target")!==void 0&&$("#"+$(this).data("target"))!==void 0&&$("#"+$(this).data("target")).val($(this).html()).trigger("change")}),$("body").on({mouseenter:function(){$(this).closest("div.overlay-options").css({background:"rgba(255,0,0,0.4)","border-color":"#ff0000"})},mouseleave:function(){$(this).closest("div.overlay-options").css({background:"","border-color":""})}},".delete"),$("body").on("click",".delete",function(){$(this).parent().parent().fadeOut("slow")}),$("body").on("click",".stripe",function(){$("body").data("processing",$(this).attr("id")),stripeHandler.open({amount:$(this).data("amount"),currency:$(this).data("currency")!==void 0?$(this).data("currency"):"USD",description:$(this).data("description"),email:$(this).data("email")!==void 0?$(this).data("email"):"",name:"Liberio",panelLabel:$(this).data("label")})}),$("body").on("click","#publisher-logo-remove",function(){$("#publisher-logo-preview").find("img").fadeOut("slow",function(){$(this).remove()}),$("#publisher-logo-input").val(""),$(this).parent().remove(),$("#publisher-logo-add").text("Add Logo")}),$("body").on("click",".drawer-right-toggle",function(){$("#drawer-right").toggleClass("in"),$(".drawer-right-toggle").find("i").toggleClass("notifiction-active").toggleClass("notifiction-inactive")}),$(document).on("click","#update-notification-action.notification-active",function(){$.each(notifications,function(e,t){d={},d.uid=t,d.values={},d.values._needsUpdate="",d.values.build=!0,$.post("api/1.0/books.json",d,function(t){"ok"==t.status&&$.get("/api/1.0/notifications.json?delete=delete&uid="+e,function(){delete notifications.index,renderNotification("#update-notification",notifications)})},"json")})}),$(document).on("click","#update-notification-action",function(){$("#update-notification-action > i").animateRotate(360,"slow","swing"),$(this).hasClass("notification-active")||checkForNotification()}),$.fn.animateRotate=function(e,t,i,n){var a=$.speed(t,i,n),o=a.step;return this.each(function(t,i){a.step=function(e){return $.style(i,"transform","rotate("+e+"deg)"),o?o.apply(this,arguments):void 0},$({deg:0}).animate({deg:e},a)})},Object.keys||(Object.keys=function(e){var t,i=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&i.push(t);return i}),function(e,t){if("function"==typeof define&&define.amd)define(["jquery","exports"],function(i,n){t(e,n,i)});else if("undefined"!=typeof exports){var i=require("jquery");t(e,exports,i)}else e.FormSerializer=t(e,{},e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,i){var n=t.FormSerializer=function n(e){function t(e,t,i){return e[t]=i,e}function i(e,i){for(var o,r=e.match(n.patterns.key);void 0!==(o=r.pop());)if(n.patterns.push.test(o)){var s=a(e.replace(/\[\]$/,""));i=t([],s,i)}else n.patterns.fixed.test(o)?i=t([],o,i):n.patterns.named.test(o)&&(i=t({},o,i));return i}function a(e){return void 0===d[e]&&(d[e]=0),d[e]++}function o(t){if(!n.patterns.validate.test(t.name))return this;var a=i(t.name,t.value);return l=e.extend(!0,l,a),this}function r(t){if(!e.isArray(t))throw Error("formSerializer.addPairs expects an Array");for(var i=0,n=t.length;n>i;i++)this.addPair(t[i]);return this}function s(){return l}function c(){return JSON.stringify(s())}var l={},d={};this.addPair=o,this.addPairs=r,this.serialize=s,this.serializeJSON=c};return n.patterns={validate:/^[a-z][a-z0-9_]*(?:\[(?:\d*|[a-z0-9_]+)\])*$/i,key:/[a-z0-9_]+|(?=\[\])/gi,push:/^$/,fixed:/^\d+$/,named:/^[a-z0-9_]+$/i},n.serializeObject=function(){return this.length>1?Error("jquery-serialize-object can only serialize one form at a time"):new n(i).addPairs(this.serializeArray()).serialize()},n.serializeJSON=function(){return this.length>1?Error("jquery-serialize-object can only serialize one form at a time"):new n(i).addPairs(this.serializeArray()).serializeJSON()},i.fn!==void 0&&(i.fn.serializeObject=n.serializeObject,i.fn.serializeJSON=n.serializeJSON),n}),Object.defineProperty(Number.prototype,"fileSize",{value:function(e,t,i,n){return(e=e?[1e3,"k","B"]:[1024,"K","iB"],t=Math,i=t.log,n=0|i(this)/i(e[0]),this/t.pow(e[0],n)).toFixed(2)+" "+(n?(e[1]+"MGTPEZY")[--n]+e[2]:"Bytes")},writable:!1,enumerable:!1}),$(document).on("click",".btn-form-trigger",function(){return $.getJSON("?trigger="+$(this).data("trigger")+"&do="+$(this).data("do")+"&what="+$(this).data("what")+"&where="+$(this).data("where")+"&reload="+$(this).data("reload")+"&target="+$(this).data("target")+"&caller="+$(this).attr("id")+"&"+$(this).parents("form:first").serialize()+"&signature="+window.btoa($("meta[property='sf:user']").attr("content")),function(e){SFCheckAlerts(),SFReloadContent("#"+e.target,e.content,e.method,e.js)}),!1}),$(document).on("change","#region",function(){$("#timezone").html('<option selected="selected">Loading...</option>').prop("disabled",!0),$("#timezone-account-form-submit-btn").prop("disabled",!0),$.getJSON("?trigger=account&do=load&region="+$(this).val()+"&target=timezone&signature="+window.btoa($("meta[property='sf:user']").attr("content")),function(e){SFCheckAlerts(),SFReloadContent("#"+e.target,e.content,e.method,e.js),$("#timezone").prop("disabled",!1),$("#timezone-account-form-submit-btn").prop("disabled",!1)})}),$(document).on("click","#growl",function(){$("#message").growl()}),$("#liberio-notification").modal("show"),$(document).on("click",".btn-vote",function(){return $("#kb-"+$(this).data("kb")+"-vote").html('<div class="space-top-10"><img src="assets/images/icons/loading_spinner_16.gif" alt="loading"> Your feedback is processed.</div>'),$.getJSON("?trigger=faq&target=kb-"+$(this).data("kb")+"-vote&do=vote&kb="+$(this).data("kb")+"&vote="+$(this).data("vote")+"&nonce="+$("meta[property='sf:nonce']").attr("content")+"&signature="+window.btoa($("meta[property='sf:user']").attr("content")),function(e){SFCheckAlerts(),SFReloadContent("#"+e.target,e.content,e.method,e.js)}),!1}),$(document).on("click","#epub-editor-save",function(){var e=$(this);e.button("loading"),$("html, body").animate({scrollTop:"0px"});var t={};t.values=$($(this).data("serialize")).serializeObject(),t.values.cover=$("#cover-image > img").data("picker-file-uri"),t.values.order=$(".dd").length&&$(".dd").data("nestable")?$(".dd").nestable("serialize"):"",t.values.keywords=$("#keywords").tagsinput("items");var i={};if($(".dd li").each(function(){i[$(this).data("id")]=$(this).find(".content-title").text()}),t.values.editable=i,t.values.metadata.subject!==void 0&&t.values.metadata.subject.length){var n=[];$.each(t.values.metadata.subject,function(e,t){-1===$.inArray(t,n)&&n.push(t)}),t.values.metadata.subject=n}if(t.values.savePreferences){var a={};a.values={},a.values.id=$("meta[property='sf:user']").attr("content")+"_liberioEpubs",a.values.collection="liberioEpubs",a.values.preferences={},a.values.preferences.use=t.values.use,a.values.preferences.hide=t.values.hide,a.values.preferences.opfVersion=t.values.opfVersion,a.values.preferences.exports=t.values.exports,a.values.preferences.metadata={},a.values.preferences.metadata.language=t.values.metadata.language,a.values.preferences.metadata.rights=t.values.metadata.rights,a.values.preferences.metadata.publisher=t.values.metadata.publisher,a.values.preferences.metadata.publisherUrl=t.values.metadata.publisherUrl,$.post("api/1.0/preferences.json/"+("null"!==t.values.savePreferences?t.values.savePreferences:""),a,function(e){"ok"==e.status},"json")}else $("#savePreferences").attr("value")&&"null"!==$("#savePreferences").attr("value")&&$.ajax({url:"api/1.0/preferences.json/"+$("#savePreferences").attr("value"),type:"DELETE",success:function(){console.log("deleted "+$("#savePreferences").val())}});$.post("api/1.0/books.json/"+(t.values.uid!==void 0?t.values.uid:""),t,function(e){if("ok"==e.status){var t={};t._requestsUpdate=e.uid,_navigateTo("liberioGridView",t)}},"json")}),$(document).on("click",".editor-delete",function(){return 2>$(".user-content").length?(alert("You must have at least one document in your book."),!1):($(this).closest("li.user-content").fadeOut("slow",function(){$(this).remove()}),void 0)}),$(document).on("click",".editor-edit",function(){$("label > span").prop("contenteditable",!1),$(this).parent().siblings("label").children("span").prop("contenteditable",!0).focus()}),$(document).on("keydown",".content-title",function(e){13===e.keyCode&&$(this).attr("contenteditable")&&$(this).blur(),$(this).parent().siblings("input[type=checkbox]").prop("checked","true")}),$(document).on("focus",".content-title",function(){$(this).parent().siblings("input[type=checkbox]").prop("checked","true")}),$(document).on("blur",".content-title",function(){$(this).removeAttr("contenteditable")}),$(document).on("click",".content-title",function(){$(this).attr("contenteditable")&&$(this).parent().siblings("input[type=checkbox]").prop("checked","true")}),$(document).on("click","label",function(e){$(this).children("span:focus").length&&e.preventDefault()}),$(document).on("change","#mainCategory",function(){$("#subject-add").siblings("div").find(".signal").toggleClass("hide"),$("#category").attr("disabled",!0),$.getJSON("?trigger=liberioBookView&do=getList&mainCategory="+encodeURIComponent($(this).val())+"&signature="+window.btoa($("meta[property='sf:user']").attr("content")),function(e){$("#category").empty(),$.each(e.content,function(e,t){$("#category").append($("<option>").text(e).attr("value",t))}),$("#category").removeAttr("disabled"),$("#subject-add").siblings("div").find(".signal").toggleClass("hide")})}),$(document).on("click",".subject-delete",function(){$(this).closest("div.subject").fadeOut("slow",function(){$(this).remove()})}),$(document).on("click","#subject-add",function(){"none"!=$("#category").val()&&$("#show-category").append('<div class="space-bottom-5 bisac subject"><div class="category mutable-element"><input type="hidden" name="metadata[subject][]" value="'+$("#category").val()+'"><span>'+$("#mainCategory option:selected").text()+" > "+$("#category option:selected").text()+'</span><span class="pull-right"><a href="#" class="mutable-delete subject-delete void">&times;</a></span></div></div>')}),$(document).on({mouseenter:function(){$(this).closest(".mutable-element").toggleClass("alert-danger")},mouseleave:function(){$(this).closest(".mutable-element").toggleClass("alert-danger")}},".mutable-delete"),$(document).on({mouseenter:function(){$(this).siblings(".flyout-right").fadeIn("slow")},mouseleave:function(){$(this).siblings(".flyout-right").fadeOut("slow")}},".flyout"),$(document).on("click","#specimen-trigger",function(){var e=$("#style").val();$("#specimen-view").removeClass().addClass(e),$("#specimen-container").slideToggle("slow",function(){$("#specimen-trigger").html(function(){return $("#specimen-container").is(":visible")?"Hide Example":"See an Example"}),$("#section-style").css("border-bottom-style",function(){return $("#specimen-container").is(":visible")?"dotted":"solid"})})}),$(document).on("change","#style",function(){var e=$(this).val();$("#"+e).length||($("#specimen-container").css("opacity","0.2"),$.getJSON("?trigger=liberioBookView&do=getCss&css="+e+"&signature="+window.btoa($("meta[property='sf:user']").attr("content")),function(t){$("<style id='"+e+"'>"+t.content+"</style>").appendTo("head"),$("#specimen-container").css("opacity","1")})),$("#specimen-view").removeClass().addClass(e)}),$("#more-options").on("shown.bs.collapse",function(){$("#specimen-container").hide(),$("#specimen-trigger").html="Show an Example"}),$(document).on("click","#allItems-check",function(){$("#liberioPanel-form").find(":checkbox").prop("checked",this.checked)}),$(document).on("click",".btn-action",function(){return"delete"!=$(this).data("do")||confirm("This action can't be undone. Continue?")?($.getJSON("?trigger=liberioPanel&target=main&do="+$(this).data("do")+"&"+$("#liberioPanel-form").serialize()+"&nonce="+$("meta[property='sf:nonce']").attr("content")+"&signature="+window.btoa($("meta[property='sf:user']").attr("content")),function(e){SFCheckAlerts(),SFReloadContent("#"+e.target,e.content,e.method,e.js)}),!1):!1}),$(document).on("click",".btn-view",function(){return $.getJSON("?trigger=liberioPanel&target=main&selector=item&item="+$(this).data("item")+"&parent="+$(this).data("parent")+"&nonce="+$("meta[property='sf:nonce']").attr("content")+"&callback=SFUpdateGoogleDocumentStatus&signature="+window.btoa($("meta[property='sf:user']").attr("content")),function(e){SFCheckAlerts(),SFReloadContent("#"+e.target,e.content,e.method,e.js,e.callback)}),!1}),$(document).on("click",".btn-download",function(){var e="hiddenDownloader",t=document.getElementById(e);return null===t&&(t=document.createElement("iframe"),t.id=e,t.style.display="none",document.body.appendChild(t)),t.src="?a=download.liberio&"+$("#liberioPanel-form").serialize(),!1});